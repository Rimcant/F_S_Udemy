pec mandates that we implicitly create sessions for operations
  // that are not explicitly provided with a session.
  let session = operation.session;
  let owner: symbol | undefined;
  if (topology.hasSessionSupport()) {
    if (session == null) {
      owner = Symbol();
      session = client.startSession({ owner, explicit: false });
    } else if (session.hasEnded) {
      throw new MongoExpiredSessionError('Use of expired sessions is not permitted');
    } else if (session.snapshotEnabled && !topology.capabilities.supportsSnapshotReads) {
      throw new MongoCompatibilityError('Snapshot reads require MongoDB 5.0 or later');
    }
  } else {
    // no session support
    if (session && session.explicit) {
      // If the user passed an explic
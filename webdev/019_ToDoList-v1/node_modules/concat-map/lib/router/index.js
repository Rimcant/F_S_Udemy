/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict';

/**
 * Module dependencies.
 * @private
 */

var Route = require('./route');
var Layer = require('./layer');
var methods = require('methods');
var mixin = require('utils-merge');
var debug = require('debug')('express:router');
var deprecate = require('depd')('express');
var flatten = require('array-flatten');
var parseUrl = require('parseurl');
var setPrototypeOf = require('setprototypeof')

/**
 * Module variables.
 * @private
 */

var objectRegExp = /^\[object (\S+)\]$/;
var slice = Array.prototype.slice;
var toString = Object.prototype.toString;

/**
 * Initialize a new `Router` with the given `options`.
 *
 * @param {Object} [options]
 * @return {Router} which is an callable function
 * @public
 */

var proto = module.exports = function(options) {
  var opts = options || {};

  function router(req, res, next) {
    router.handle(req, res, next);
  }

  // mixin Router class functions
  setPrototypeOf(router, proto)

  router.params = {};
  router._params = [];
  router.caseSensitive = opts.caseSensitive;
  router.mergeParams = opts.mergeParams;
  router.strict = opts.strict;
  router.stack = [];

  return router;
};

/**
 * Map the given param placeholder `name`(s) to the given callback.
 *
 * Parameter mapping is used to provide pre-conditions to routes
 * which use normalized placeholders. For example a _:user_id_ parameter
 * could automatically load a user's information from the database without
 * any additional code,
 *
 * The callback uses the same signature as middleware, the only difference
 * being that the value of the placeholder is passed, in this case the _id_
 * of the user. Once the `next()` function is invoked, just like middleware
 * it will continue on to execute the route, or subsequent parameter functions.
 *
 * Just like in middleware, you must either respond to the request or call next
 * to avoid stalling the request.
 *
 *  app.param('user_id', function(req, res, next, id){
 *    User.find(id, function(err, user){
 *      if (err) {
 *        return next(err);
 *      } else if (!user) {
 *        return next(new Error('failed to load user'));
 *      }
 *      req.user = user;
 *      next();
 *    });
 *  });
 *
 * @param {String} name
 * @param {Function} fn
 * @return {app} for chaining
 * @public
 */

proto.param = function param(name, fn) {
  // param logic
  if (typeof name === 'function') {
    deprecate('router.param(fn): Refactor to use path params');
    this._params.push(name);
    return;
  }

  // apply param functions
  var params = this._params;
  var len = params.length;
  var ret;

  if (name[0] === ':') {
    deprecate('router.param(' + JSON.stringify(name) + ', fn): Use router.param(' + JSON.stringify(name.slice(1)) + ', fn) instead')
    name = name.slice(1)
  }

  for (var i = 0; i < len; ++i) {
    if (ret = params[i](name, fn)) {
      fn = ret;
    }
  }

  // ensure we end up with a
  // middleware function
  if ('function' !== typeof fn) {
    throw new Error('invalid param() call for ' + name + ', got ' + fn);
  }

  (this.params[name] = this.params[name] || []).push(fn);
  return this;
};

/**
 * Dispatch a req, res into the router.
 * @private
 */

proto.handle = function handle(req, res, out) {
  var self = this;

  debug('dispatching %s %s', req.method, req.url);

  var idx = 0;
  var protohost = getProtohost(req.url) || ''
  var removed = '';
  var slashAdded = false;
  var sync = 0
  var paramcalled = {};

  // store options for OPTIONS request
  // only used if OPTIONS request
  var options = [];

  // middleware and routes
  var stack = self.stack;

  // manage inter-router variables
  var parentParams = req.params;
  var parentUrl = req.baseUrl || '';
  var done = restore(out, req, 'baseUrl', 'next', 'params');

  // setup next layer
  req.next = next;

  // for options requests, respond with a default if nothing else responds
  if (req.method === 'OPTIONS') {
    done = wrap(don n>l.Z.theme.breakpoints.medium?t.createElement(s,{style:a},t.createElement(o,{style:d.contentWide},e)):t.createElement(o,{style:a},e)},d=l.Z.create((e=>({frame:{backgroundColor:e.colors.gray50,borderRadius:e.borderRadii.medium,boxShadow:e.boxShadows.medium},browserBar:{backgroundColor:e.colors.cellBackground,borderTopStartRadius:e.borderRadii.medium,borderTopEndRadius:e.borderRadii.medium,borderBottomWidth:e.spaces.space1,borderBottomColor:e.colors.gray200,display:"inline-flex",flexDirection:"row",gap:e.spaces.space36,paddingHorizontal:e.spaces.space20},browserBarButtons:{alignItems:"center",display:"inline-flex",flexDirection:"row",gap:e.spaces.space8,height:e.spaces.space40},browserBarButton:{backgroundColor:e.colors.gray200,borderColor:e.colors.gray400,borderRadius:e.borderRadii.infinite,borderWidth:e.borderWidths.small,height:e.spaces.space12,width:e.spaces.space12},browserBarUrlInputWrapper:{flex:1,height:e.spaces.space40,justifyContent:"center"},browserBarUrlInput:{backgroundColor:e.colors.gray50,borderRadius:e.borderRadii.infinite,height:e.spaces.space28},contentWide:{paddingBottom:e.spaces.space32,paddingHorizontal:e.spaces.space32,paddingTop:e.spaces.space12},content:{backgroundColor:e.colors.cellBackground,borderRadius:e.borderRadii.large,boxShadow:e.boxShadows.medium,minHeight:358,overflow:"hidden"}})))},66005:(e,a,n)=>{n.d(a,{Z:()=>p});n(6886),n(36728),n(85940);var t=n(2784),r=n(7267),l=n(84292),i=n(73228),s=n.n(i),o=n(30239);const c=s().af4d0a80,d=s().c701e5cc,u=s().a649778c,m=s().d4ab68e2,p=e=>{const{onNavigation:a,shouldBlockNavigation:n}=e,i=(0,r.k6)(),[s,p]=t.useState(void 0),g=t.useCallback(((e,a)=>!n(e,a)||(p({nextLocation:e,action:a}),!1)),[p,n]);t.useEffect((()=>i.block(g)),[g,i]);const b=t.useCallback((()=>{p(void 0)}),[p]),f=t.useCallback((()=>{null==a||a(),p((e=>{if(null==e)return;const{action:a,nextLocation:n}=e;switch(a){case"PUSH":i.push(n);break;case"REPLACE":i.replace(n);break;case"POP":i.goBackThroughModals({fallbackPath:o.LI})}}))}),[i,a,p]);return s?t.createElement(l.Z,{cancelButtonLabel:u,confirmButtonLabel:m,confirmButtonType:"destructiveFilled",headline:c,onCancel:b,onConfirm:f,text:d}):null}},62316:(e,a,n)=>{n.d(a,{Z:()=>o,j:()=>s.j});var t=n(2784),r=n(25686),l=n(36934),i=n(73186),s=n(50584);const o=e=>{const{children:a,childrenStyle:n,headline:i,illustration:o,rightControl:d}=e;return t.createElement(r.Z,{style:c.root},o&&t.createElement(s.Z,{style:c.illustration,type:o}),t.createElement(r.Z,{style:c.header},t.createElement(l.ZP,{accessibilityLevel:3,accessibilityRole:"heading",size:"headline1",style:c.headline,weight:"heavy"},i),d),a&&t.createElement(r.Z,{style:n},a))},c=i.Z.create((e=>({root:{marginHorizontal:e.componentDimensions.gutterHorizontal,marginTop:e.spaces.space20,marginBottom:e.spaces.space24},header:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},headline:{marginVertical:e.spaces.space12},illustration:{alignSelf:"start"}})))},20927:(e,a,n)=>{n.d(a,{Z:()=>F});var t=n(7896),r=n(2784),l=n(25686),i=n(7267),s=n(5252),o=n(73186),c=n(73228),d=n.n(c),u=n(21783),m=n(292),p=n(19313),g=n(30239),b=n(29496),f=n(92748),w=n(48199);const _=d().b90f3f82,h=d().d1a683b8,y=()=>{const{featureSwitches:e}=r.useContext(p.rC),a=e.isTrue("super_follow_web_rename_enabled");return r.createElement(b.ZP,{accessibilityLabel:a?h:_,icon:r.createElement(f.default,null),link:w._t,type:"primaryText"})},k=d().a6777c1c,v=d().d7b51c68,F=e=>{const{bottomBar:a,children:n,leftControlShouldClose:o,percentageComplete:c,rightControl:d,screenRef:b,withCenteredLogo:f,withInfoButton:w,..._}=e,h=(0,i.k6)(),{featureSwitches:F}=r.useContext(p.rC),E=F.isTrue("super_follow_web_rename_enabled"),Z=o?"close":"back",C=g.LI,x=f?r.createElement(u.default,{style:S.iconTwitter}):void 0,D=w?r.createElement(l.Z,{style:S.rightControl},r.createElement(y,null),d):d,K=c?r.createElement(s.Z,{progress:c}):void 0,P=r.createElement(r.Fragment,null,r.createElement(l.Z,{style:S.childrenWrapper},n),a&&r.createElement(l.Z,{style:S.bottomBarWrapper},a)),B=()=>{o?h.goBackThroughModals({fallbackPath:C}):h.goBack({backLocation:C})};return b&&(b.current={goBack:B}),r.createElement(m.Z,(0,t.Z)({},_,{backButtonType:Z,backLocation:C,centeredLogo:x,children:P,documentTitle:E?v:k,onBackClick:B,rightControl:D,secondaryBar:K}))},S=o.Z.create((e=>({iconTwitter:{color:e.colors.primary,flexGrow:1,height:"1.75rem"},rightControl:{alignItems:"center",flexDirection:"row",gap:e.spaces.space4},childrenWrapper:{flexBasis:0,flexGrow:1,flexShrink:1,overflow:"auto"},bottomBarWrapper:{borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small,boxShadow:e.boxShadows.small}})))},39703:(e,a,n)=>{n.d(a,{Z:()=>s});var t=n(7896),r=(n(6886),n(36728),n(21515),n(2784)),l=n(7267),i=n(29496);const s=e=>{const{disabled:a,label:n,onPress:s,path:o,...c}=e,d=(0,l.k6)(),[u,m]=r.useState(!1),p=()=>{d.push(o)};return r.createElement(i.ZP,(0,t.Z)({},c,{disabled:u||a,onPress:e=>{s?(m(!0),s(e).then(p).finally((()=>m(!1)))):p()}}),n)}},62126:(e,a,n)=>{n.d(a,{Z:()=>s});var t=n(7896),r=(n(36728),n(2784)),l=n(7267),i=n(36934);const s=({label:e,path:a,...n})=>{const s=(0,l.k6)();return r.createElement(i.ZP,(0,t.Z)({},n,{onPress:()=>{s.push(a)},underlineWeight:"heavy",weight:"bold",withUnderline:!0}),e)}},64469:(e,a,n)=>{n.d(a,{Z:()=>x});var t=n(2784),r=n(25686),l=(n(85488),n(77660)),i=n.n(l),s=n(23162),o=n(73186),c=n(73228),d=n.n(c),u=n(80843),m=n(114),p=n(83362),g=n(52872);const b=e=>t.createElement(p.Z,null,t.createElement(r.Z,{style:f.browserContent},t.createElement(g.Z,e))),f=o.Z.create((e=>({browserContent:{paddingBottom:e.spaces.space48}})));var w,_,h=n(99241),y=n(84153),k=n(30239),v=n(87906);const F=d().iba08a94,S=d().ef354e84,E=d().a5f55bfa,Z=void 0!==w?w:w=n(21158),C=void 0!==_?_:_=n(33596),x=({user:e,viewer:a})=>{var n,l;const o=i()(Z,e),c=i()(C,a),d=(0,h.h)("super_follow_web_rename_enabled"),{name:p,profile_image_url_https:g,protected:f,screen_name:w,verified:_}=(null==o?void 0:o.legacy)||{},{is_blue_verified:x}=o,K=null!=(n=(0,y.JG)(c))?n:"",P=null!=(l=(0,y.fJ)(c))?l:"";return t.createElement(t.Fragment,null,t.createElement(u.Z,{style:D.interstitial},t.createElement(m.Z,{headline:F,subtext:d?E:S})),t.createElement(s.Z,null),t.createElement(u.Z,{style:D.previewCallout},t.createElement(v.Z,{path:k.Km})),t.createElement(r.Z,{style:D.summaryFramed},t.createElement(b,{badgeImageUrl:null!=g?g:void 0,badgeName:null!=p?p:void 0,badgeScreenName:null!=w?w:void 0,descriptionValue:P,imageUrl:null!=g?g:void 0,introValue:K,isBlueVerified:x||!1,isProtected:f,isVerified:_,name:null!=p?p:void 0,screenName:null!=w?w:void 0})))},D=o.Z.create((e=>({interstitial:{marginBottom:e.spaces.space28,marginTop:e.spaces.space32},previewCallout:{marginBottom:e.spaces.space4,marginTop:e.spaces.space20},blob:{paddingTop:0,paddingBottom:0,paddingStart:0,paddingEnd:0},summaryFramed:{marginTop:e.spaces.space20,marginHorizontal:e.spaces.space20,marginBottom:e.spaces.space32}})))},40690:(e,a,n)=>{n.d(a,{Z:()=>O});var t=n(2784),r=n(14983),l=n.n(r),i=n(25686),s=(n(85488),n(77660)),o=n.n(s),c=n(23162),d=n(73186),u=n(54044),m=n(73228),p=n.n(m),g=n(65526),b=n(7896),f=n(83362),w=n(92346);const _=(e,a)=>{const{style:n,...r}=e;return t.createElement(f.Z,{style:n},t.createElement(w.Z,(0,b.Z)({},r,{ref:a,withVisibilityCallout:!0})))},h=t.forwardRef(_);var y,k,v=n(80843),F=n(114),S=n(87906),E=n(84153),Z=n(30239),C=n(62126);const x=p().gf32cca2,D=p().j8ba99b4,K=p().j679dcda,P=void 0!==y?y:y=n(9823),B=void 0!==k?k:k=n(48316),I=(e,a)=>{var n;const{autoFocus:r,descriptionMaxLength:s,user:m,viewer:p}=e,{windowWidth:b}=(0,u.F)(),f=b>d.Z.theme.breakpoints.medium,w=t.useRef();(0,g.q)((()=>{var e;r&&null!=(e=w.current)&&e.scrollIntoView&&w.current.scrollIntoView()}));const _=o()(P,m),y=o()(B,p),{profile_image_url_https:k,screen_name:I}=null!=(n=_.legacy)?n:{},O=(0,E.fJ)(y),T=(0,E.NP)(y,"description");return l()("string"==typeof k,"imageUrl must be defined"),l()("string"==typeof I,"screenName must be defined"),t.createElement(t.Fragment,null,t.createElement(v.Z,{style:L.interstitial},t.createElement(F.Z,{headline:x,subtext:D})),t.createElement(v.Z,{style:L.examplesLink},t.createElement(C.Z,{label:K,path:Z.$w})),t.createElement(c.Z,null),t.createElement(v.Z,{style:L.previewCallout},t.createElement(S.Z,{path:Z.Km})),t.createElement(h,{autoFocus:r,imageUrl:k,onChange:e=>{T(e.currentTarget.value)},ref:a,screenName:I,style:[L.preview,f&&L.previewWide],value:O,valueMaxLength:s}),t.createElement(i.Z,{ref:w}))},O=t.forwardRef(I),L=d.Z.create((e=>({interstitial:{marginTop:e.spaces.space32},examplesLink:{marginBottom:e.spaces.space28,marginTop:e.spaces.space24},previewCallout:{marginBottom:e.spaces.space4,marginTop:e.spaces.space20},preview:{marginVertical:e.spaces.space16,marginHorizontal:e.spaces.space32},previewWide:{marginHorizontal:e.spaces.space16}})))},63125:(e,a,n)=>{n.d(a,{Z:()=>T});var t=n(2784),r=n(14983),l=n.n(r),i=n(25686),s=(n(85488),n(77660)),o=n.n(s),c=n(23162),d=n(73186),u=n(54044),m=n(73228),p=n.n(m),g=n(65526),b=n(80843),f=n(114),w=n(7896),_=n(83362),h=n(1805);const y=(e,a)=>{const{style:n,...r}=e;return t.createElement(_.Z,{style:n},t.createElement(h.Z,(0,w.Z)({},r,{ref:a})))},k=t.forwardRef(y);var v,F,S=n(19313),E=n(84153),Z=n(30239),C=n(62126),x=n(87906);const D=p().j325331a,K=p().h1e80994,P=p().e18e8da8,B=p().j679dcda,I=void 0!==v?v:v=n(73892),O=void 0!==F?F:F=n(51914),L=(e,a)=>{var n;const{autoFocus:r,introMaxLength:s,user:m,viewer:p}=e,{windowWidth:w}=(0,u.F)(),_=w>d.Z.theme.breakpoints.medium,h=t.useRef();(0,g.q)((()=>{var e;r&&null!=(e=h.current)&&e.scrollIntoView&&h.current.scrollIntoView()}));const y=o()(I,m),v=o()(O,p),{name:F,profile_image_url_https:L}=null!=(n=y.legacy)?n:{},T=(0,E.JG)(v),V=(0,E.NP)(v,"creator_intro");l()("string"==typeof L,"imageUrl must be defined"),l()("string"==typeof F,"name must be defined");const{featureSwitches:U}=t.useContext(S.rC),$=U.isTrue("super_follow_web_rename_enabled");return t.createElement(t.Fragment,null,t.createElement(b.Z,{style:R.interstitial},t.createElement(f.Z,{headline:D,subtext:$?P:K})),t.createElement(b.Z,{style:R.examplesLink},t.createElement(C.Z,{label:B,path:Z.o5})),t.createElement(c.Z,null),t.createElement(b.Z,{style:R.previewCallout},t.createElement(x.Z,{path:Z.Km})),t.createElement(k,{autoFocus:r,imageUrl:L,name:F,onChange:e=>{V(e.currentTarget.value)},ref:a,style:[R.preview,_&&R.previewWide],value:T,valueMaxLength:s}),t.createElement(i.Z,{ref:h}))},T=t.forwardRef(L),R=d.Z.create((e=>({interstitial:{marginTop:e.spaces.space32},examplesLink:{marginBottom:e.spaces.space28,marginTop:e.spaces.space24},previewCallout:{marginBottom:e.spaces.space4,marginTop:e.spaces.space20},preview:{marginVertical:e.spaces.space16,marginHorizontal:e.spaces.space32},previewWide:{marginHorizontal:e.spaces.space16}})))},87906:(e,a,n)=>{n.d(a,{Z:()=>p});var t=n(2784),r=n(25686),l=n(36934),i=n(73186),s=n(73228),o=n.n(s),c=n(62126);const d=o().hf6f2914,u=o().i859a9d4,m=i.Z.create((e=>({root:{alignItems:"center",flexDirection:"row",justifyContent:"space-
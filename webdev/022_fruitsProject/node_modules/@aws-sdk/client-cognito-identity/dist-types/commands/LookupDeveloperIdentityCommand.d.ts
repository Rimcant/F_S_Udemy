renderVideo(){const{promotedContent:t,video:e,videoId:o}=this.props;return s.createElement(O.Z,(0,u.Z)({},r.Z.extractVideoProps(o,e),{onPlaybackStarted:this._handlePlaybackStarted,playbackCoordination:null,promotedContent:t,setPlayer:this._setPlayer,withPostPlayback:!0}))}}const U=l.Z.create({root:{flexBasis:0,flexGrow:1,flexShrink:1,justifyContent:"center"}}),F=N,j=y().ac85c6b2,G=t=>{const{businessAvatar:e=!1,isAvatar:o,isCurrentlyDisplayed:n,mediaDetail:a,onDismiss:l,onTap:h,promotedContent:d,videoId:c,...m}=t,[g,y]=s.useState(null),[f,Z]=s.useState({width:0,height:0}),{isModal:b}=s.useContext(_.Z),{height:S,width:x}=a.original_info||{},{height:w,width:D}=f,T=b||o?(0,C.I5)({mediaWidth:x,mediaHeight:S,containerWidth:D,containerHeight:w},o):H.mediaItem;return s.createElement(v,{onDismiss:l,onLayout:b||o?t=>{const{nativeEvent:{layout:{height:e,width:o}}}=t;o===f.width&&e===f.height||Z({width:o,height:e})}:void 0,style:H.root},g?s.createElement(p.Z,{onRetry:()=>{y(null)},style:H.errorDetail,title:j,withLightOnDarkColorScheme:!0}):null,g?null:s.createElement(i.Z,{onClick:t=>{t.stopPropagation()},style:T},"photo"===a.type?s.createElement(R,(0,u.Z)({},m,{imageStyle:o&&!e&&H.avatarImage,onError:t=>{y(t.nativeEvent.error)},onLoad:()=>{y(null)},onTap:h,photo:a,style:H.container,zoomable:!0})):r.Z.isVideo(a)&&c?s.createElement(F,{isCurrentlyDisplayed:n,promotedContent:d,style:H.container,video:a,videoId:c}):null))},H=l.Z.create((t=>({root:{flexGrow:1,justifyContent:"center",alignItems:"center",flexShrink:1},mediaItem:{flexGrow:1,width:"100%",height:"100%"},container:{height:"100%",position:"absolute",width:"100%"},errorDetail:{alignItems:"center",alignSelf:"center",justifyContent:"center",position:"absolute",height:"100%",maxWidth:400},avatarImage:{borderRadius:t.borderRadii.infinite,margin:t.spaces.space16}}))),K=s.memo(G,((t,e)=>(0,h.Z)(t,e)));class $ extends s.Component{constructor(t,e){super(t,e),this._getV2Key=()=>{const{mediaItems:t}=this.props;if(t.length){const[e]=t,o=e.expanded_url;if("string"==typeof o){const t=o.split("/");if(t.length>=4)return t[3]}}},this._handleChangeV2=({index:t,intersectionRatio:e})=>{const{onMediaItemChanged:o}=this.props;1===e&&o&&o(t)},this._getItemVideoId=t=>{const{videoId:e}=this.props;if(e)return e;if("string"==typeof t.expanded_url){const e=t.expanded_url.split("/");return c.Z.forTweet(e[3])}},this._handleMediaDetailZoomed=t=>{const{onMediaDetailZoomed:e}=this.props;this.state.isZoomed!==t&&this.setState({isZoomed:t}),e&&e(t)},this.state={isZoomed:!1}}shouldComponentUpdate(t,e){return!(0,h.Z)(t,this.props)||!(0,h.Z)(e,this.state)}render(){const{businessAvatar:t,dataSaver:e,mediaIndex:o,mediaItems:n,onDismiss:a,onTap:l,promotedContent:h}=this.props,{isZoomed:d}=this.state,c=n.map(((i,c)=>{const m=r.Z.isVideo(i),u=this._getItemVideoId(i),p=o===c;return m&&!u?null:s.createElement(K,{businessAvatar:t,dataSaver:e,isAvatar:this.props.isAvatar,isCurrentlyDisplayed:p,key:c,mediaDetail:n[c],onDismiss:d?void 0:a,onTap:l,onZoomed:p?this._handleMediaDetailZoomed:void 0,promotedContent:h,resetZoom:o!==c,videoId:u})}));return s.createElement(i.Z,{style:q.root},n.length>1?this._renderCarousel(c):c)}_renderCarousel(t){const{dominantColor:e,mediaIndex:o,mediaItems:i,onMediaItemChanged:l}=this.props,{isZoomed:h}=this.state,d=r.Z.isVideo(i[o]);return this.context.featureSwitches.isTrue("responsive_web_carousel_v2_media_detail_enabled")?s.createElement(a.Z,{childrenStyle:[q.dimensions,q.scrollSnap],dominantButtonColor:e,isLocked:h,key:this._getV2Key(),onVisibleRangeChange:this._handleChangeV2,scrollToCenter:!0,style:q.dimensions,swipeablePaddingLeft:0,swipeablePaddingRight:0,visibleItemIndex:o,withAddedNavButtonClickArea:!d,withGlobalKeyboar